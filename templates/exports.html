{{ template "header.html" . }}

<div class="flex justify-between items-center mb-4">
    <div>
        <h1>Exports</h1>
    </div>

    <div class="flex gap-2">
        <form method="GET" action="/exports">
            <button class="btn btn-secondary btn-icon" title="Refresh Page">
                <i data-lucide="refresh-cw"></i>
            </button>
        </form>

        <a href="/" class="btn btn-secondary">Back to Home</a>

    </div>
</div>

<div class="card mb-4">
    <div class="card-header">Export Configuration</div>
    <div class="flex justify-between items-center flex-responsive">
        <div>
            <p><strong>Username:</strong> <span class="badge badge-neutral">{{.username}}</span></p>
            <p><strong>User ID:</strong> <span class="badge badge-neutral">{{.user_id}}</span></p>
        </div>
        <div class="flex flex-col gap-2 items-end">

            <form method="POST" action="/export/start" onsubmit="return submitWithConfirm(this);">
                <input type="hidden" name="user_id" value="{{.user_id}}">
                <input type="hidden" name="sync_method" value="csv">
                <button type="submit" class="btn btn-secondary" style="width: 160px; justify-content: flex-start;">
                    <i data-lucide="file-text"></i> CSV Export
                </button>
            </form>

            <form method="POST" action="/exports/deleteAll"
                onsubmit="return submitWithConfirm(this, 'Do you want to delete all exports? Files will be completely removed.');">
                <input type="hidden" name="user_id" value="{{.user_id}}">
                <button type="submit" class="btn btn-danger" style="width: 160px; justify-content: flex-start;">
                    <i data-lucide="trash-2"></i> Delete All
                </button>
            </form>

        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">Generated Exports</div>

    {{if not .exports}}
    <div class="text-center" style="padding: 2rem; color: var(--color-text-muted);">
        <i data-lucide="folder-open" style="width: 48px; height: 48px; opacity: 0.5;"></i>
        <p>No exports available.</p>
    </div>
    {{else}}
    <div class="flex flex-col gap-2">
        {{range .exports}}
        <div class="source-item">
            <div class="source-info">
                <div class="flex items-center gap-2">
                    <strong style="font-size: 1.05rem;">Export {{.ID}}</strong>
                    <span class="badge badge-neutral">{{.ExportMethod}}</span>

                    {{if eq .ExportStatus "Requested"}}
                    <span class="badge badge-warning">Queued</span>
                    {{else if eq .ExportStatus "Processing"}}
                    <span class="badge badge-warning">Processing</span>
                    {{else if eq .ExportStatus "Completed"}}
                    <span class="badge badge-success">Completed</span>
                    {{else if eq .ExportStatus "Failed"}}
                    <span class="badge badge-danger">Failed</span>
                    {{end}}
                </div>

                <div class="source-meta">
                    <span>Created: {{.CreatedAt.Format "Jan 02 15:04"}}</span>
                    {{if not .CompletedAt.IsZero}}
                    Â· <span>Completed: {{.CompletedAt.Format "Jan 02 15:04"}}</span>
                    {{end}}

                    {{if .StatusMessage.Valid}}
                    <span title="{{.StatusMessage.String}}"><i data-lucide="info"
                            style="width: 14px; height: 14px; margin-left: 5px;"></i></span>
                    {{end}}
                </div>
            </div>

            <div class="source-actions">
                {{if .DownloadUrl.Valid}}
                <form method="GET" action="{{.DownloadUrl.String}}">
                    <button type="submit" class="btn btn-primary btn-icon" title="Download">
                        <i data-lucide="download"></i>
                    </button>
                </form>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
    {{end}}
</div>

{{ template "footer.html" . }}